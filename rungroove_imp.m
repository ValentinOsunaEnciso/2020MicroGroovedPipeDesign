function fitness=rungroove_imp(x)    
    % CANDIDATE SOLUTION:
    % 150 <= st <= 235;     Saturated temperature, in oC.
    % 0.025 <= R <= 0.05;   Inner radius of pipe, in m.
    % kf, Kind of fluid: 1Benzene, 2Water, 3Ethanol, 4Methanol
    % Type of groove: 1Semicircular, 2Triangular
    R=x(1,1);
    beta=x(1,2);
    gamma = x(1,3);    
    st = x(1,4);
    p = x(1,5);
    psi = x(1,6);
    r_m = x(1,7);
    kf = x(1,8);
    tg = x(1,9);
    
    % OTHER VALUES:
    y0=[0.4; 0];
    tspan=[0 10];       

    % FUNCTIONS:
    [rho_l,sigma,mu_l] = fluido(kf,st);

    switch (tg)
        case 1 %Semicircular
            %r_m = 0.00035;  % .0005 <= r_m <= .0008; Radius of semicircular groove    
%             opt = odeset('RelTol',1e-1,'Stats','on','OutputFcn',@odeplot);
            opt=odeset('Events',@events);
            [t,y]=ode45(@(t,y)groove1(t,y, R, beta, gamma, sigma, rho_l, r_m, mu_l),tspan,y0,opt);
        case 2 % Triangular
            %p = 0.00043;    % .00025 <= p <= .0004; Height of triangular groove
            %angulo=51;
            %psi = (angulo*pi/180);     % Apex angle of triangular groove
%             opt = odeset('RelTol',1e-5,'Stats','on','OutputFcn',@odeplot);
            opt=odeset('Events',@events);
            [t,y]=ode45(@(t,y)groove2(t,y, R, beta, gamma, sigma, rho_l, mu_l, p, psi),tspan,y0,opt);
        otherwise
            disp('Unknown groove.')  
    end
    Y=y(:,1); 
    Z=2.*[0.400000000000000;0.400000002752209;0.400000011008821;0.400000024769819;0.400000044035182;0.400000222926799;0.400000539424609;0.400000993526116;0.400001585228781;0.400006607667698;0.400015069730729;0.400026971053535;0.400042311245670;0.400170579758131;0.400384746429687;0.400684733122212;0.401070445442543;0.404280512461604;0.409610236439862;0.417029986326271;0.426500785037847;0.476586225476250;0.549263032958494;0.640742315291033;0.747012548082691;0.871432404310769;1.00357373552147;1.13995388320392;1.27726987016763;1.40733374363864;1.53434678684706;1.65719089595316;1.77489071791546;1.90615336596272;2.02887435145508;2.14288022286065;2.24810299657039;2.37185241812405;2.48186519432522;2.57911789404947;2.66458558999936;2.76573911552712;2.84896949456144;2.91679322141962;2.97147969996376;3.03757953737483;3.08090091606700;3.10612895622150;3.11748058387650;3.11881105088108;3.11419681168378;3.10455275331040;3.09064832269205;3.06628355319420;3.03672613997704;3.00332669483272;2.96737621577680;2.93393077791665;2.90069991718893;2.86885349743225;2.83944964292000;2.81465434939791;2.79373723729109;2.77722994959580;2.76533076414716;2.75860877913320;2.75528005840471;2.75501307622779;2.75738350836717;2.76170615615615;2.76753831739929;2.77440803360777;2.78189898472019;2.79038505448231;2.79872254274447;2.80655623924898;2.81364410406689;2.81936667683908;2.82423069826995;2.82819718668137;2.83126743375585;2.83360873343443;2.83501755687761;2.83558911488459;2.83543071365770;2.83454847151843;2.83309293810699;2.83123321611466;2.82911796148427;2.82693973708370;2.82476970892278;2.82270826965033;2.82082762240988;2.81935628020727;2.81809758102728;2.81706713724910;2.81626879599047;2.81568286020934;2.81532511595571;2.81517469039772;2.81520644278315;2.81540809581022;2.81574517978011;2.81617997026419;2.81667873665622;2.81728069534636;2.81788231273352;2.81844879203108;2.81895699141997;2.81933897660704;2.81965694434581;2.81990752593958;2.82009110718709;2.82021843616595;2.82027667073536;2.82027495983896;2.82022341999114;2.82009869401713;2.81993309910176;2.81975044678549;2.81956782183221;2.81939393322610;2.81924692882568;2.81913445658810;2.81905744079223;2.81901588407506;2.81900025762863;2.81900628980758;2.81902916280516;2.81907680322369;2.81913334621791;2.81918847820965;2.81923690871471;2.81927866471213;2.81930578777959;2.81931778799945;2.81931794512220;2.81931049275903;2.81929810672782;2.81928403391097;2.81927031889257;2.81925528323515;2.81924525307352;2.81924143232931;2.81924187823762;2.81924444001168;2.81924844346159;2.81925241070516;2.81925567719653;2.81925892350982;2.81926006510459;2.81925888916272;2.81925718035048;2.81925622805576;2.81925560216273;2.81925556724853;2.81925580262784;2.81925630025052;2.81925668949152;2.81925644704203;2.81925585441825;2.81925552500239;2.81925566680173;2.81925625371375;2.81925656347248;2.81925614660394;2.81925584694460;2.81925595801739;2.81925623727303;2.81925907370751;2.81925863033402;2.81925236395953;2.81925121522861;2.81925657869349;2.81925986792267;2.81925879641788;2.81925630136018;2.81925540874142;2.81925516143391;2.81925572570041;2.81925631580565;2.81925643939932;2.81925629877529;2.81925591696302;2.81925584290086;2.81925924662271;2.81926036759129;2.81925522619659;2.81925057064745;2.81925228150450;2.81925499947360;2.81925686868189;2.81925722401859;2.81925665260085;2.81925607770998;2.81925588139636;2.81925597883479;2.81925865623060;2.81926001735300;2.81925628299967;2.81925115317027;2.81925117489640;2.81925286418486;2.81925504516760;2.81925652598323;2.81925706779423;2.81925710253508;2.81925669700130;2.81925627064687;2.81925571573961;2.81925557284122;2.81925622945717;2.81925676184207;2.81925533784439;2.81925365503230;2.81925406837698;2.81925774529552;2.81925981237577;2.81925994137388;2.81925842970392;2.81925679112883;2.81925591263695;2.81925543501348;2.81925552425097;2.81925582537212;2.81925637585765;2.81925672265339;2.81925635846717;2.81925576921094;2.81925548448392;2.81925584720023;2.81925679635655;2.81925692895052;2.81925473860578;2.81925386045867;2.81925603488796;2.81925825242113;2.81925716956430;2.81925478834500;2.81925318730055;2.81925528086155;2.81925883053998;2.81925999024715;2.81925812310578;2.81925595915578];
    if max(t)>=8
        temp=mahal(Y,Z);
        fitness=sum(temp);        
    else
        fitness=1e5;
    end
    figure
    plot(t,y(:,1))
    title('Microgroove theta:');
    xlabel('Time t');
    ylabel('theta');

    figure
    plot(t,y(:,2))
    title('Microgroove velocity:');
    xlabel('Time t');
    ylabel('velocity');

    figure
    plot(y(:,1),y(:,2))
    title('velocity vs theta:');
    ylabel('velocity');
    xlabel('theta');
end
function [value,isterminal,direction] = events(t,y)
    % Locate the time when height passes through zero in a decreasing
    %direction
    % and stop integration.
    value = y(1)-3.14; % detect y-1/2 = 0
    isterminal = 1; % stop the integration
    direction = 0; % negative direction
end
